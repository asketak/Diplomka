%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% I, the copyright holder of this work, release this work into the
%% public domain. This applies worldwide. In some countries this may
%% not be legally possible; if so: I grant anyone the right to use
%% this work for any purpose, without any conditions, unless such
%% conditions are required by law.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[
  digital, %% This option enables the default options for the
           %% digital version of a document. Replace with `printed`
           %% to enable the default options for the printed version
           %% of a document.
  table,   %% Causes the coloring of tables. Replace with `notable`
           %% to restore plain tables.
  lof,     %% Prints the List of Figures. Replace with `nolof` to
           %% hide the List of Figures.
  lot,     %% Prints the List of Tables. Replace with `nolot` to
           %% hide the List of Tables.
  %% More options are listed in the user guide at
  %% <http://mirrors.ctan.org/macros/latex/contrib/fithesis/guide/mu/fi.pdf>.
  oneside
]{fithesis3}
%% The following section sets up the locales used in the thesis.
\usepackage{listings}
\usepackage[resetfonts]{cmap} %% We need to load the T2A font encoding
\usepackage[T1,T2A]{fontenc}  %% to use the Cyrillic fonts with Russian texts.
\usepackage[
  main=english, %% By using `czech` or `slovak` as the main locale
                %% instead of `english`, you can typeset the thesis
                %% in either Czech or Slovak, respectively.
 %english, german, russian, czech, slovak %% The additional keys allow
]{babel}        %% foreign texts to be typeset as follows:
%%
%%   \begin{otherlanguage}{german}  ... \end{otherlanguage}
%%   \begin{otherlanguage}{russian} ... \end{otherlanguage}
%%   \begin{otherlanguage}{czech}   ... \end{otherlanguage}
%%   \begin{otherlanguage}{slovak}  ... \end{otherlanguage}
%%
%% For non-Latin scripts, it may be necessary to load additional
%% fonts:
\usepackage{paratype}

\usepackage[
   backend=biber        % if we want unicode
  ,style=authoryear % or iso-numeric for numeric citation method
  ,autolang=other       % to support multiple languages in bibliography
  ,sortlocale=cs_CZ     % locale of main language, for sorting
  ,bibencoding=UTF8     % this is necessary only if bibliography file is in different encoding than main document
]{biblatex}
\def\textrussian#1{{\usefont{T2A}{PTSerif-TLF}{m}{rm}#1}}
%%
%% The following section sets up the metadata of the thesis.
\thesissetup{
    date          = \the\year/\the\month/\the\day,
    university    = mu,
    faculty       = fi,
    type          = mgr,
    author        = Tomáš Šíma,
    gender        = m,
    advisor       = {RNDr. Martin Stehlík, Ph.D, Mgr. Jaroslav Šeděnka},
    title         = {OSINT: Correlation and inference of information from social media},
    TeXtitle      = {OSINT: Correlation and inference of information from social media},
    keywords      = {blockhain, bitcoin, OSINT, darkweb, drug market, TOR, cryptocurrency, anonymity, metadata},
    TeXkeywords   = {blockhain, bitcoin, OSINT, darkweb, drug market, TOR, cryptocurrency, anonymity, metadata},
    abstract      = {The goal of this thesis is to create a tool to find, analyze and visualize publicly available data, which can be helpful to deanonymize users of drug markets available via TOR on dark web. The aim of this tool is to help investigators with collecting intelligence on entities related to these drug markets. Users and operators of these markets employ multiple means to prevent their deanonymization. The markets are operated ad TOR services, PGP encryption is often required to use in communication between multiple parties and bitcoin is used as a way to pay for goods or services.
    
    I scraped multiple publicly available social sites and websites related to bitcoin(twitter,bitcointalk, reddit, blockchain.info...) and drug markets thereself using python. I stored all these data into AgensGraph database, which is a graph database based on PostgreSQL. I created a tool, which uses these data and multiple heuristics to analyze and visualize data and metadata of users,drug markets, social media and blockchain. Tool can also for given adress find the nearest adresses or transactions related to drug markets and also find the nearest adresses that are mentioned in scraped websites. 
    
    To test the efficiency of this tool, I created multiple profiles on these dark markets and performed multiple transactions to deposit and withdraw bitcoins. The tool identified these and these percent of transactions.
    },
    thanks        = {I would like to thank my supervisor RNDr. Martin Stehlík Ph.D for guiding me and providing technical support for my work. 
    
    I would also like to thank Mgr. Jaroslav Šeděnka for his continuous stream of helpful comments and ideas.
    
    Access to computing and storage facilities owned by parties and projects contributing to the National Grid Infrastructure MetaCentrum provided under the programme "Projects of Large Research, Development, and Innovations Infrastructures" (CESNET LM2015042), is greatly appreciated.},
    bib           = citations.bib
}

\usepackage{makeidx}      %% The `makeidx` package contains
\makeindex                %% helper commands for index typesetting.
%% These additional packages are used within the document:
\usepackage{paralist} %% Compact list environments
\usepackage{amsmath}  %% Mathematics
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{url}      %% Hyperlinks
\usepackage{markdown} %% Lightweight markup
\usepackage{listings} %% Source code highlighting
\usepackage{graphicx}
\graphicspath{ {images/} }
\lstset{
  basicstyle      = \ttfamily,%
  identifierstyle = \color{black},%
  keywordstyle    = \color{blue},%
  keywordstyle    = {[2]\color{cyan}},%
  keywordstyle    = {[3]\color{olive}},%
  stringstyle     = \color{teal},%
  commentstyle    = \itshape\color{magenta}}
\usepackage{floatrow} %% Putting captions above tables
\floatsetup[table]{capposition=top}
\begin{document}
\chapter{Introduction}
%\addcontentsline{toc}{chapter}{Introduction}

The relative anonymity of internet offer an incentive for criminal parties to use internet as a tool for their activities.
Internet facilitated some forms of existing crimes(Selling drugs and guns, counterfeits selling, Ponzi schemes) and also enabled many new types of frauds like hacking, phishing and carding.
Police statistics show, that crime happening online is much less likely to be discovered and criminals persecuted. Criminals value their anonymity very high and use various means to make them even more anonymous,
like VPNs and TOR. The big problem for criminals were getting the money they got from criminal activity to their possession(In banknotes, or to their bank account), since that requires some form physical presence.
Also, it was hard for two anonymous entities engaging in criminal activity to transfer money to each other, since none could be sure about the origin of money they are receiving.

For bitcoin, there is no central authority requiring bitcoin address( bitcoin equivalent of bank account number) to be linked to person's identity.
Criminals can use their anonymous connection to internet to both recieve and send bitcoins and therefore not disclose their identity.
This feature of bitcoin and other cryptocurrencies gave rise to drug markets, which can be publicly accessed via TOR. However,
the history of all bitcoin transactions is publicly available and so each bitcoin can be tracked through the whole transaction history.

In this work I collect multiple public sources of data about bitcoin transactions, bitcoin adresses and drug markets.
I examine these data in order to describe the behaviour of drug markets users (distribution of sellers, availability of drugs,
number of users, revenues) and also to see, if these data can be used for disclosing identity of users and operators of drug markets.


\section{Goals}

The main goal of this thesis is to map two currently available drug markets 
and try multiple approaches for deanonymization of identities related to these drug markets.
Another outcome of this work is a proof of concept tool, that uses the data mentioned above to help investigator to disclose transactions,
addresses and identities related to online drug markets.
The secondary outcome of this work is gathering data about the trades, which happened on the drug markets and
 gather interesting statistics about the whole market as well as actors operating there.

\section{Structure of thesis}

The following text describes individual chapters forming structure of this thesis.
The chapter Related works give overview of work already done on similar topics and 
how this work differ or extend the previous done research.

The chapter Technology and terms gives quick introduction to bitcoin and blockchain, which is used for paying on crypto markets.
Then it describes how the dark markets operate within dark web.

The chapter Methods and tools to get and analyze data describe the proccess of collecting the data from bitcoin blockchain,
drug markets and pubicly available sites(Mainly forums and social networks). 

The Deanonymization techniques chapter descibe heuristics and methods that are later used by the proof of concept application to detect 
addresses used by drug markets and link the users of drug markets to publicly found identities.

The chapter Statistics of drug markets describes various statistics about drug markets, that were gathered during drug market website scraping.
It contains two parts, the first is focused on statistics related to money, the second part is giving insight about non-money related statistics.

POC application chapter describes the functionality, implementation and 
possible future development of application for investigating bitcoin addresses, which was created as part of this thesis.

Testing and verification of the created tool descibes the proccess by which the proof of concept application was tested and the results

The last chapter Discussion is about achieving goals, problems of implementation and future work.

\chapter{Related works}
\section{Pairing blockchain transactions with public data}
Multiple papers were published regarding analysis of blockchain graph. The \parencite{reid2013analysis} was published in 2013 and dealt with much smaller number of people using bitcoin and smaller transaction graph.
Their analysis also focus on danonymization through multiple aspects of bitcoin protocol, while this thesis focus on deanonymization from transaction graph and public data.
The \parencite{ron2013quantitative} focus on bringing interesting statistics about bitcoin transaction graph and track only really big(>50000 BTC)
transactions on the network. The authors of this paper also had to deal with much smaller blockchain graph.

Similar work to this thesis was done by \parencite{fleder2015bitcoin}. This paper use data from bitcointalk, the most popular bitcoin forum. 
They apply simple algorithm to group multiple bitcoin adresses belonging to one user together. Than they use the scraped data to show
that some of the bitcointalk users were using silkroad marketplace or other popular services accepting bitcoin.

Advanced and similar work was done by \parencite{spagnuolo2014bitiodine}. They downloaded the blockchain, transformed to the database
and performed clustering to get graph of transaction between users.
Than they developed a tool, which scraped data from multiple locations(bitcointalk and bitcoin-OTC forum) to link off-chain data and identities to bitcoin adresses.
They tested the tool on few popular transactions related to seizure of silkroad marketplace.

All of the previously mentioned works had to deal with much smaller transaction graph, as the usage of bitcoin grew exponentionally over the last year. 
My work is unique in that way, that it utilize much more sources of data, than the works previous mentioned. Also, the aim of this tool is to be able
to identify even just regular users of drug markets, not just big and important transactions.

\section{Behaviour of drug markets users and operators}

Papers describing the drug market users,vendors and the dynamic of
the online drug marketplace economy mostly focused on data related to silkroad marketplace seizure. 
Few authors described, how is the whole drug trafficking crime changing overtime with the coming of the new technologies.
There are only few articles focusing on describing the economy of fully operating drug market at the time of data collection.
In this work, I bring analysis of the micro-economy of two fully operating drug markets and present interesting statistics about vendors,
size and frequency of the deals and their sortiment and availability.

\chapter{Technology and terms}

In this chapter, I explain the terms, tools and related technology used for achieving the goal of this thesis.

\section{Bitcoin and blockchain}
Bitcoin is a distributed, decentralized crypto-currency. The users of Bitcoin
are called clients, each of whom can command accounts, known as addresses.
A client can send Bitcoins to another client by forming a transaction and committing
it into a global append-only log called the blockchain. The blockchain
is maintained by a network of miners, which are compensated for their effort in
Bitcoins. Bitcoin transactions are protected with cryptographic techniques that
ensure only the rightful owner of a Bitcoin address can transfer funds from it.
The miners are in charge of recording the transactions in the blockchain,
which determines the ownership of Bitcoins.

Bitcoin blockchain is basically a graph of transaction, where each transaction has some inputs and output.
The transaction can be inserted to blockchain only by owner of all it's inputs. The miners check, if the inputs of the transaction were not already spent and if the transaction is ccorrect,
they insert the transaction into blockchain.
Blockchain data structure is basically a graph of transactions, where outputs of previous transactions are used as inputs for newer transactions.

\chapter{Methods and tools to get and analyze data}
\section{Obtaining,storing and analyzing blockchain data}
In order to create a tool, that will find data related to bitcoin adresses, I need to store the blockchain locally in that way, that common graph algorithms can be applied.
I ran the official bitcoin daemon (further referenced as bitcoind), to obtain a copy of bitcoin blockchain. Bitcoind store blockchain in multiple *.blk files.
These files have structure, which is unfit for searching, processing and analysis of blockchain, so I used rusty-parser to parse these files and create csv files of transactions, outputs and adresses.

Than I imported these files into neo4j graph database, to have whole transaction graph in one place and be able to compute statistics and heuristics.
All entities in the \ref{neo4jschema} are represented as graph nodes, the relationships between them are edges.
\begin{figure}[h]
    \centering
    \includegraphics[width=1\textwidth]{neo4j-schema}
    \caption{Neo4j database ER diagram}
    \label{neo4jschema}
\end{figure}

\section{Drug markets web scraping and data collection}
I scraped data from dream market and valhalla, 2 big popular drug markets available via TOR. I scraped the vendor nicknames, buyer reviews and the sortiment that each vendor sells.
I tested, if every transaction that is happening on drug market has its counter transaction in bitcoin blockchain. I sent 0.05 bitcoins to both markets,
bought a virtually deliverable legally service(link to secret forum) and checked, if the bitcoins that I have sent to deposit adress left.
For both markets, there was no transaction happening for days after the transaction was done. This means, that markets don't transfer bitcoins,
when there is filled order, all the transactions that these drug markets do are just for depositing bitcoins on drug market account,
withdraw bitcoins and money laundering bitcoins.
I made multiple deposits and withdraws from drug markets in order to track, where were the deposited bitcoins transfered and where the withdrawn bitcoins originated.
These deposits and withdrawals are used to test the resulting application
I scraped 158 vendor PGP keys from dream market and 70 PGP keys from walhalla. I tested these keys, if they are vulnerable to ROCA attack, via python module roca-detect. None of these keys were vulnerable.
All these PGP keys were searched for User-Id in metadata of PGP key and these user-Ids were seached by google. None of thesearches for user-Ids(both nicknames and mail addresses) returned any results.

I thought that metadata from the photos of drugs, which are available on the drug markets might be useful.
I downloaded hundreds of pictures both from walhalla and dream market.
Only metadata directly dependending on image content(like amount of red, green and blue colors) differ,
metadata that could potentionally help dislosing user identity(date of creation nad modification, signature, software version) were the same.
The software version contained line: $ImageMagick 6.8.9-9 Q16 x86_64 2017-07-31 http://www.imagemagick.org$
I created vendor account on both markets and uploaded an image with custom made metadata to see,
if the metadata were scraped and same version of software version appears. It happened so for both markets,
therefore I believe, that markets automatically scrape metadata from uploaded images in order to protect privacy of the users.

\section{Drug market server fingerprinting}
I tried to scan ports of drug markets servers and fingerprint their webserver, in order to find any vectors of further information gathering.
I scanned both drug markets servers using netcat, finding, that the only opened port is number 443(HTTPS), which is used by webserver.
I used httprecon to fingerprint used HTTP server. The fingerprinting consists of sending multiple malformed HTTP requests and comparing the webserver output with the database of responses by different webservers.
The results of fingerprinting can be see in figure xxx, the best matches are various modern versions of apache webserver.
The results of port scan and webserver printing doesn't indicate any way how to gather data about drug markets servers.

\section{Publicly available data scraping}
In order to have some bitcoind addresses and bitcoins linked to identities, I searched internet for pages, where are bitcoin adresses tied to real or virtual identities.
The interesting sites that I decided to scrape were bitcointalk forum, bitcoin-OTC, reddit, twitter, bitcoin.info.
The bitcointalk and bitcoin-OTC are the most popular internet forums related to cryptocurrencies. The script bitcointalk-scraper.py visits profile pages of all profiles on both forums (even those without any posts)
 and matched with bitcoin address regular expression.
 
The reddit and twitter were scraped by twitter-reddit-scraper.py. The script contain several hardcoded phrases like "Donate bitcoin" and "bitcoind address" and scrapes the results of search page.
Bitcoin.info is a webpage that serves primarly as bitcoin blockchain explorer, secundary,
it gathers multiple statistics about bitcoin blockchain and also offers for third parties to have their bitcoin address and identity listed on their webpage.
Some of these identities are verifies by signaturing custom made message with the bitcoin address associated private key.

I scraped data with the intention to link identities to bitcoin addresses. The data scraped from public sources are rows with thre collums: bitcoin addres, URL where was the addres scraped and username of the associated identity.
All data scraped from the public sources(bitcointalk, reddit,twitter, bitcoin-OTC) are imported to the same neo4j graph database as metadata belonging to the nodes representing given address.


\chapter{Deanonymization techniques}
\section{Detecting wallets owned by drug markets}
\section{Using own transactions to get market wallets}

\chapter{Statistics of drug markets}
\section{Financial flows in dream market}
\section{Statistics about vendors, drugs availability and distribution and buyers satisfaction}



\chapter{POC application}

This chapter describes the proof of concept application for investigating bitcoin address.
The application consists of three parts.
The scraping module, that downloads bitcoin blockchain and also scrape data from publicly available sites mention in section XXX.
The computanional module, which imports data to the database and also transform data. so that searching in these data would be fast.
The scraping, import and computanional modules are available for linux only.
The GUI written in HTML/JS/CSS, that is connecting to neo4j database REST endpoint and provides visualisation of data.
The GUI can be given a configuration string, to connect to neo4j REST API endpoint, so the gui can be viewed in broser from any device, as long as 
the server with neo4j data is reachable from that device.


\section{Implementation}

The importing module is responsible for parsing bitcoin blockchain files and importing the data into neo4j database.
The importing module take two parameters, the directory of .blk files, which store blockchain data and directory for creating neo4j graph database.
The import module firstly parses the .blk files and save blockchain as multiple .csv files. This intermidiary step is useful for debugging and also simplifies importing to neo4j database.

\begin{figure}[h]
    \centering
    \includegraphics[width=1\textwidth]{application_architecture}
    \caption{Neo4j database ER diagram}
    \label{application_architecture}
\end{figure}

The next importing script is scrape\_identities.py script, which crawl popular forums and multiple websites and creates identities.csv.
File identities.csv contains 3 collumns.
\begin{itemize}
  \item Address - bitcoin address the identity is associated with
  \item Identity - String representing identity, usually username
  \item URL - Url where the Identity and Address were scraped
\end{itemize}

If the user has his own data about the owners of different bitcoin addresses, he can import it through the web GUI later.


\section{Usage}

\noindent See the following command :
\begin{lstlisting}[language=bash]
  $ ./import_module ~/.blockchain/ ~/neo4j/graph.db
\end{lstlisting}

\section{Future development possibilities}


\chapter{Testing and verification of the created tool}
This chapter describes the way, the POC application was tested.

The testing were performed by sending bitcoins to drug markets and withdrawing them.
Than marking the addresses from where the bitcoins were recieved as 

\section{Method of testing}
\section{results}



\chapter{Conclusion}

Here you can insert the appendices of your thesis.gg
\end{document}
